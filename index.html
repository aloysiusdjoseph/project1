<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<title>PhoneGap Build Sample</title>
		<script type="text/javascript" src="phonegap-1.0.0.js"></script>
		<script type="text/javascript" src="pouchdb-3.0.6.min.js"></script>
		<script type="text/javascript">
		/*global PouchDB*/
        var db = new PouchDB('books', {adapter: 'websql'}),
        	remote = 'https://iotiot:iot$$$iot@iotiot.cloudant.com/iotserver',
        	opts = {
      			continuous: true
    		};
    	if (!db.adapter) { // websql not supported by this browser
          db = new PouchDB('books')
        }
		db.replicate.to(remote, opts);
		db.replicate.from(remote, opts);
			
        function addBook() {
            var booktitle = window.document.bookform.titlefield.value;
            var bookisbn = window.document.bookform.isbnfield.value;
            var bookauthor = window.document.bookform.authorfield.value;
            var book = {
                _id: bookisbn,
                title: booktitle,
                author: bookauthor
            };
            db.put(book, function callback(error, result) {
                alert(error || result);
                if (!error) {
                    clearFields();
                    document.getElementById("message").innerHTML =
                            "the new book was successfully added";
                }
            });
        }
        function clearFields() {
            window.document.bookform.titlefield.value="";
            window.document.bookform.authorfield.value="";
            window.document.bookform.isbnfield.value="";
        }
        function showBooks() {
            db.allDocs( {include_docs: true, descending: true},
                        function(err, doc) {
                            showTableOfBooks(doc.rows);
                        } );
        }
        function showTableOfBooks(data) {
            var div = document.getElementById("message");
            var str = "<table border='1' aligh='left'><tr><th>isbn</th>"+
                    "<th>title</th><th>author</th></tr>";
            for(var i=0; i<data.length; i++)
            {
                str +=  "<tr><td>"+data[i].doc._id+
                        "</td><td>"+data[i].doc.title+
                        "</td><td>"+data[i].doc.author+"</td></tr>"
            }
            str += "</table>";
            div.innerHTML = str;
                    
        }
		</script>
			
		</script>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
		<meta name="apple-mobile-web-app-capable" content="yes"/>
</head>
	<body>
    <form name="bookform">
        book title <input type="text" name="titlefield" />
        <br/>
        book author <input type="text" name="authorfield" />
        <br/>
        book isbn <input type="text" name="isbnfield" />
        <br/>
        <input type="button" value="add book" onClick="addBook()" />
        <br/>
        <input type="button" value="clear fields" onClick="clearFields()" />
        <br/>
        <input type="button" value="show books" onClick="showBooks()" />
    </form>
    <div id="message"></div>
	</body>
</html>